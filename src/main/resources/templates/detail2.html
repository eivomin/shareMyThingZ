<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">

<head>
  <!-- Bulma CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
  <!-- JS -->

  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="/js/script.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <link href="/css/style.css" rel="stylesheet" type="text/css" />
  <title>Category</title>

  <style>

  </style>
  <script>


    $(document).ready(function () {
      let p_id = $("#p_id").val();

      getData(p_id);
    });

    //ê²Œì‹œê¸€, ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°
    function getData(p_id) {

      //ê²Œì‹œê¸€ ë¶€ë¶„
      fetch(`/api/posts/${p_id}`)
              .then((res) => res.json())
              .then((data) => {
                $('.body-title-head').empty();
                $('.body-write').empty();
                $('.body-text').empty();

                let title = data['title'];
                let desc = data['content'];
                let image = data['img_url'];
                let comments = data['comments'];
                let writer = data['username'];
                let boardId = data['boardId'];
                let reg_date = data['createdDate'];
                let mod_date = data['lastModifiedDate'];
                let url = data['img_url'];
                var like = data['like_cnt'];

                let jsDate = new Intl.DateTimeFormat('kr').format(new Date(reg_date))

                $('#detailImg').attr('src', image);

                let detail_title = `<h1 class="title-text">${title}</h1>
            <img src="/image/underline_black.png" class="underline" alt="">`
                $('.body-title-head').append(detail_title);

                let detail_writer = `
                                <div class="write-er">
                                 <p>ğŸ“${writer}</p>
                                </div>
                                <div class="write-date-time">
                                  <p>ğŸ“…${jsDate}</p>
                                </div>`
                $('.body-write').append(detail_writer);

                let detail_comment = `<p>${desc}</p>`
                $('.body-text').append(detail_comment);

                let tmp_html = `<div class="heart">
                              <button class="heart-btn" onclick="addLike()">
                                <i class="far fa-heart fa-2x"></i>
                              </button>
                              <div class="like_count">ì¢‹ì•„ìš” ${like}ê°œ</div>
                            </div>`;
                $('.tmp').append(tmp_html);

                //ëŒ“ê¸€ ë¶€ë¶„

                $('#replyBox').empty();

                console.log(comments);

                comments.forEach((a) => {
                  let r_id = a['id'];
                  let user_name = a['username'];
                  let comment = a['content'];
                  let reg_date = a['createdDate'];

                  let temp_html = `<div class="reply-data" id="reply${r_id}">
                                      <input id="replyName${r_id}" value="${user_name}" style="font-weight: bolder;" disabled/>
                                      <input id="replyComment${r_id}" value="${comment}" disabled/>
                                      <p style="color: gray;">(${reg_date})</p>
                                      <div id="reply-edit-btn${r_id}"><button id="${r_id}" onclick="modifycomment(this)" >ìˆ˜ì •</button></div>
                                      <div id="reply-del-btn"><button onclick="deletecomment('${r_id}')" class="reply-del-btn${r_id}">ì‚­ì œ</button></div>
                                      <div id="reply-edited-btn${r_id}" style="display: none"><button id="${r_id}" onclick="modifyReply(this)" class="reply-edited-btn">ìˆ˜ì •ì™„ë£Œ</button></div>
                                      <div id="reply-editFin-btn${r_id}"><button onclick="replyRe()" style="display: none" class="reply-editedFin-btn">ì·¨ì†Œ</button></div>
                                  </div>`;
                  $('#replyBox').append(temp_html);
                });
              });



    }

    function postingcomment() {

      const auth = getToken();

      let comment = $('#commentcontent').val();
      let p_id = $("#p_id").val();

      $.ajax({
        type: 'POST',
        url: `/api/comments`,
        contentType: "application/json",
        data: JSON.stringify({postId: p_id,
          content: comment}),
        beforeSend: function (xhr) {
          xhr.setRequestHeader("Authorization", auth);
        },
        success: function (response) {
          alert('ëŒ“ê¸€ ë“±ë¡ ì„±ê³µ!');
          window.location.reload();
        },
        error(error, status, request) {
          console.error(error);
          alert('ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨!');
          window.location.href = host + "/api/user/login-page";
        }
      });
    }

    //ê²Œì‹œê¸€ ì‚­ì œ
    function deletepost() {

      const auth = getToken();

      let p_id = $("#p_id").val();

      $.ajax({
        type: 'DELETE',
        url: `/api/posts/`+p_id,
        contentType: "application/json",
        beforeSend: function (xhr) {
          xhr.setRequestHeader("Authorization", auth);
        },
        success: function (response) {
          alert('ê²Œì‹œê¸€ ì‚­ì œ ì„±ê³µ!');
          window.location.href='/';
        },
        error(error, status, request) {
          console.error(error);
          alert('ê²Œì‹œê¸€ ì‚­ì œ ì‹¤íŒ¨!');
          window.location.href = host + "/api/user/login-page";
        }
      });
    }

    //ëŒ“ê¸€ ì‚­ì œ
    function deletecomment(r_id) {

      const auth = getToken();

      $.ajax({
        type: 'DELETE',
        url: `/api/comments/`+r_id,
        contentType: "application/json",
        beforeSend: function (xhr) {
          xhr.setRequestHeader("Authorization", auth);
        },
        success: function (response) {
          alert('ëŒ“ê¸€ ì‚­ì œ ì„±ê³µ!');
          window.location.reload();
        },
        error(error, status, request) {
          console.error(error);
          alert('ëŒ“ê¸€ ì‚­ì œ ì‹¤íŒ¨!');
          window.location.reload();
        }
      });
    }

    //ê²Œì‹œê¸€ ì¢‹ì•„ìš” ì—…ë°ì´íŠ¸
    function addLike() {

      const auth = getToken();
      let p_id = $("#p_id").val();

      $.ajax({
        type: 'POST',
        url: `/api/posts/`+p_id+`/like`,
        contentType: "application/json",
        beforeSend: function (xhr) {
          xhr.setRequestHeader("Authorization", auth);
        },
        success: function (response) {
          alert('ê²Œì‹œê¸€ ì¢‹ì•„ìš” ì„±ê³µ!');
          window.location.reload();
        },
        error(error, status, request) {
          console.error(error);
          alert('ê²Œì‹œê¸€ ì¢‹ì•„ìš” ì‹¤íŒ¨!');
          window.location.reload();
        }
      });
    }

    function newPage(e) {
      let p_id = $(e).attr('id');
      window.location.href=`/api/board/posts/${p_id}`;
    }
  </script>
</head>

<body>
<!-- íšŒì›ê°€ì… ëª¨ë‹¬ì°½ -->
<div class="sign-up-black-bg">
  <div class="sign-up-bg">
    <h1 style="font-family:'PyeongChangPeace-Bold'; text-align: center;">í™˜ì˜í•©ë‹ˆë‹¤!</h1>
    <div class="sign-up-box">
      <div class="sign-up-inside">
        <p>ë‹‰ë„¤ì„</p>
        <form>
          <input type="text" placeholder="6ê¸€ì ë¯¸ë§Œ" id="sign-ni-Box" />
        </form>
      </div>
      <div class="sign-up-inside">
        <p>ì•„ì´ë””</p>
        <form>
          <input type="text" placeholder="6ê¸€ì ì´ìƒ" id="sign-id-Box" />
        </form>
      </div>
      <div class="sign-up-inside">
        <p>ë¹„ë°€ë²ˆí˜¸</p>
        <form>
          <input type="password" placeholder="6ê¸€ì ì´ìƒ" id="sign-pw-Box" />
        </form>
      </div>
    </div>
    <div style="text-align: center">
      <button type="submit" class="sign-up-btn send-btn" id="sign-up-send" onclick="register()">
        ì™„ë£Œ
      </button>
      <button type="button" class="sign-x-btn close-btn" id="close">
        ë‹«ê¸°
      </button>
    </div>
  </div>
</div>
<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ì°½ -->
<div class="sign-in-black-bg">
  <div class="sign-in-bg">
    <h1 style="font-family:'PyeongChangPeace-Bold'; text-align: center;">ë¡œê·¸ì¸</h1>
    <div class="sign-in-box">
      <button id="login-kakao-btn" onclick="location.href='https://kauth.kakao.com/oauth/authorize?client_id=339181dafb8c6b59189e42ac818b482c&redirect_uri=http://localhost:8080/api/user/kakao/callback&response_type=code'">
        ì¹´ì¹´ì˜¤ë¡œ ë¡œê·¸ì¸í•˜ê¸°
      </button>
      <button id="login-google-btn" onclick="location.href='/oauth2/authorization/google'">
        êµ¬ê¸€ë¡œ ë¡œê·¸ì¸í•˜ê¸°
      </button>
      <div class="sign-in-inside">
        <p>ì•„ì´ë””</p>
        <form>
          <input type="text" placeholder="ID" id="sign-in-id-Box" />
        </form>
      </div>
      <div class="sign-in-inside">
        <p>ë¹„ë°€ë²ˆí˜¸</p>
        <form>
          <input type="password" placeholder="PW" id="sign-in-pw-Box" />
        </form>
      </div>
    </div>
    <div style="text-align: center">
      <button type="submit" class="sign-in-btn send-btn" id="sign-in-send" onclick="login()">
        ë¡œê·¸ì¸
      </button>
      <button type="button" class="sign-in-x-btn close-btn" id="in-close">
        ë‹«ê¸°
      </button>
    </div>
  </div>
</div>

<!-- ì·¨í–¥ ê³µìœ í•˜ê¸° ëª¨ë‹¬ì°½ -->
<div class="black-bg">
  <div class="white-bg">
    <h1 style="text-align: center; font-family: PyeongChangPeace-Bold">
      'ì·¨í–¥'ì„ ê³µìœ í•˜ì„¸ìš”!
    </h1>
    <form id="writeForm">
      <div class="write-box">
        <div class="write-box-inside">
          <p>ì¹´í…Œê³ ë¦¬</p>
          <select id="cateBox" size="1">
            <option value="1">ì˜í™”</option>
            <option value="2">ìŒì•…</option>
            <option value="3">ì• ë‹ˆ</option>
            <option value="4">ìš´ë™</option>
            <option value="5">ì±…</option>
          </select>
        </div>
        <div class="write-box-inside">
          <p>íƒ€ì´í‹€</p>
          <input type="text" class="text-box" placeholder="íƒ€ì´í‹€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" id="titleBox" />
        </div>
        <div class="write-box-inside">
          <p>URL</p>
          <input type="text" class="text-box" id="urlBox" placeholder="URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”" />
        </div>
        <div class="write-box-inside">
          <p id="writer"></p>
        </div>
        <div class="write-box-inside">
          <p>ì½”ë©˜íŠ¸</p>
          <input type="text" id="commentBox" class="text-box" style="height: 200px" placeholder="ì·¨í–¥ì— ëŒ€í•œ ì½”ë©˜íŠ¸ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”" />
        </div>
        <div style="clear: both"></div>
      </div>

      <div style="text-align: center">
        <button type="button" class="write-btn send-btn" id="send" onclick="writePost()">
          ì „ì†¡
        </button>
        <button type="button" class="write-btn close-btn" id="close">
          ë‹«ê¸°
        </button>
      </div>
    </form>
  </div>
</div>
<!-- header ë¶€ë¶„ -->
<div class="contentContainer">
  <div class="headerWrap">
    <div class="memberHeader">
      <a onclick="window.location.href='/'">
        <img src="/image/logo_image.png" class="logo" alt="">
      </a>
      <th:block th:switch="${board_id}">
        <p id="changeLogo" th:case="1">ì˜í™”</p>
        <p id="changeLogo" th:case="2">ìŒì•…</p>
        <p id="changeLogo" th:case="3">ì• ë‹ˆ</p>
        <p id="changeLogo" th:case="4">ìš´ë™</p>
        <p id="changeLogo" th:case="5">ì±…</p>
      </th:block>
      <input type="hidden" id="board_id" name="board_id" th:value="${board_id}">
      <div id="login-true" style="display: none">
        <div id="header-title-login-user">
          <div id="user"></div> ë‹˜ì˜
        </div>
        <div id="header-title-select-shop">
          ê²Œì‹œíŒ
        </div>
        <button id="logout" onclick="logout('check')">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
      <div id="login-false" >
        <div id="header-title-select-shop">
          ê²Œì‹œíŒ
        </div>
        <button id="sign-up">íšŒì›ê°€ì…</button>
        <button id="sign-in">ë¡œê·¸ì¸</button>
      </div>
    </div>
  </div>
  <div class="background">
    <!-- ì™¼ìª½ ë‚´ë¸Œë°” ë¶€ë¶„ -->
    <div class="left-navbar">
      <div class="left-navbar-menu">
        <p>category</p>
      </div>
      <div class="left-navbar-content">
        <div class="category" id="category-1"><a id="movie" onclick="location.href='/api/board/1'">
          <img src="/image/circle.png" class="circle1" alt="">
          <div>ì˜í™” ğŸ¬</div>
        </a>
        </div>
        <div class="category" id="category-2"><a id="music" onclick="location.href='/api/board/2'">
          <img src="/image/circle.png" class="circle2" alt="">
          <div>ìŒì•… ğŸ§</div>
        </a>
        </div>
        <div class="category" id="category-3"><a id="ani" onclick="location.href='/api/board/3'">
          <img src="/image/circle.png" class="circle3" alt="">
          <div>ì• ë‹ˆ ğŸ“º</div>
        </a>
        </div>
        <div class="category" id="category-4"><a id="health" onclick="location.href='/api/board/4'">
          <img src="/image/circle.png" class="circle4" alt="">
          <div>ìš´ë™ âš½</div>
        </a>
        </div>
        <div class="category" id="category-5"><a id="book" onclick="location.href='/api/board/5'">
          <img src="/image/circle.png" class="circle5" alt="">
          <div>ì±… ğŸ“š</div>
        </a>
        </div>
      </div>
      <button class="write">ë‚´ ì·¨í–¥ ê³µìœ í•˜ê¸°</button>
    </div>
    <!-- ìƒì„¸í˜ì´ì§€ í¼ -->
    <div class="body">
      <div class="body-title">
        <div class="body-title-head">
          <h1 class="title-text" id="detailtitle">ë‰´ì§„ìŠ¤ì˜ í•˜ì…ë³´ì´ìš”</h1>
          <img src="/image/underline_black.png" class="underline" alt="">
        </div>
        <div class="body-write">
          <div class="write-er">
            <p>ğŸ“ì‹ ìƒ˜</p>
          </div>
          <div class="write-date-time">
            <p>ğŸ“…2023.03.28 21:30</p>
          </div>
        </div>
        <div style="float: none; clear: both;"></div>
      </div>
      <div class="body-detail">
        <div class="body-img">
          <img
                  src="https://img1.daumcdn.net/thumb/R1280x0.fjpg/?fname=http://t1.daumcdn.net/brunch/service/user/epXm/image/WTEOnfO6X44JawwreKjDtHTO7EI.jfif"
                  class="image" alt="" id="detailImg">
        </div>
        <div class="body-text">
          <p>(1,2,3,4)
            Baby, got me looking so crazy
            ë¹ ì ¸ë²„ë¦¬ëŠ” daydream
            Got me feeling you
            ë„ˆë„ ë§í•´ì¤„ë˜
          </p>
        </div>
      </div>
      <div class="tmp " style="float:none; clear:both;"></div>
      <!-- =====ì¢‹ì•„ìš”ë²„íŠ¼ê³¼ ê°œìˆ˜========ìš”===== -->
      <!-- ======================= -->
      <div style="float:none; clear:both;"></div>
      <div class="body-btn">
        <button class="list-btn" onclick="back()">ëª©ë¡</button>
        <button class="edit-btn">ìˆ˜ì •</button>
        <button class="del-btn" onclick="deletepost()">ì‚­ì œ</button>
      </div>
      <div class="reply">
        <!-- ===ëŒ“ê¸€ì‘ì„±===================== -->
        <div class="reply-box">
          <input type="hidden" id="p_id" name="p_id" th:value="${p_id}">
          <input type="text" class="reply-name" id="commentwriter" placeholder="ì‘ì„±ì" readonly><br>
          <input type="text" class="reply-text" id="commentcontent" placeholder="ëŒ“ê¸€ì„ ë‚¨ê²¨ì£¼ì„¸ìš”!">
          <button class="reply-btn" onclick="postingcomment()">ëŒ“ê¸€ ë‚¨ê¸°ê¸°<br>ğŸ’¬</button>
        </div>
        <!-- ===ëŒ“ê¸€============= -->
        <div id="replyBox"></div>
      </div>
    </div>
  </div>
</div>
<script>

  // =============íšŒì›ê°€ì…==============
  $('#sign-up').on('click', function () {
    $('.sign-up-black-bg').addClass('show-modal');
  });
  $('.sign-x-btn').on('click', function () {
    $('.sign-up-black-bg').removeClass('show-modal');
    window.location.reload();
  });

  $('#sign-up-send').on('click', function (e) {
    if ($('#sign-ni-Box').val() === '') {
      alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”')
      e.preventDefault()
    }
    if ($('#sign-id-Box').val() === '') {
      alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
      e.preventDefault()
    }
    if ($('#sign-pw-Box').val() === '') {
      alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
      e.preventDefault()
    }
    if ($('#sign-pw-Box').val().length < 6) {
      alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ 6ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”')
      e.preventDefault()
    }
  })

  // ==================ë¡œê·¸ì¸=========================
  $('#sign-in').on('click', function () {
    $('.sign-in-black-bg').addClass('show-modal');
  });
  $('.sign-in-x-btn').on('click', function () {
    $('.sign-in-black-bg').removeClass('show-modal');
    window.location.reload();
  });

  $('#sign-in-send').on('click', function (e) {
    if ($('#sign-in-id-Box').val() === '') {
      alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
      e.preventDefault()
    }
    if ($('#sign-in-pw-Box').val() === '') {
      alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
      e.preventDefault()
    }
  })
  // ì·¨í–¥ê³µìœ =========================
  $('.write').on('click', function () {
    $('.black-bg').addClass('show-modal');
  });
  $('.close-btn').on('click', function () {
    $('.black-bg').removeClass('show-modal');
    window.location.reload();
  });
  // ì¹´í…Œê³ ë¦¬ ë‚´ë¹„ë°”===================
  $('#category-1').hover(function () {
    $('.circle1').addClass('circle-show');
  }, function () {
    $('.circle1').removeClass('circle-show')
  });

  $('#category-2').hover(function () {
    $('.circle2').addClass('circle-show');
  }, function () {
    $('.circle2').removeClass('circle-show')
  });

  $('#category-3').hover(function () {
    $('.circle3').addClass('circle-show');
  }, function () {
    $('.circle3').removeClass('circle-show')
  });

  $('#category-4').hover(function () {
    $('.circle4').addClass('circle-show');
  }, function () {
    $('.circle4').removeClass('circle-show')
  });

  $('#category-5').hover(function () {
    $('.circle5').addClass('circle-show');
  }, function () {
    $('.circle5').removeClass('circle-show')
  });

</script>
</body>

</html>