<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/html">
<head>
    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <!-- JS -->

    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <link href="/css/style.css" rel="stylesheet" type="text/css" />
    <title>Category</title>

    <script>
        let targetId;
        let host = 'http://' + window.location.host;

        $(document).ready(function () {
            $('#cards-box').empty();
            // cookie ì—¬ë¶€ í™•ì¸í•˜ì—¬ ë¡œê·¸ì¸ í™•ì¸
            const auth = getToken();

            // ì²˜ìŒ ë¡œë”© ì‹œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì´ë¦„ ë° í´ë”)
            if(auth !== '') {
                // ë¡œê·¸ì¸í•œ ìœ ì € ì´ë¦„
                $.ajax({
                    type: 'GET',
                    url: `/api/user-info`,
                    beforeSend: function (xhr) {
                        xhr.setRequestHeader("Authorization", auth);
                    },
                    success: function (response) {
                        if (response === 'fail') {
                            logout();
                            window.location.reload();
                        } else {
                            $('#user').text(response);
                        }
                    },
                    error(error, status, request) {
                        console.error(error);
                        logout();
                        window.location.href = host + "/api/user/login-page";
                    }
                });
                $('#login-true').show();
                $('#login-false').hide();
            } else {
                $('#login-false').show();
                $('#login-true').hide();
            }

        })


        function login() {

            let username = $('#sign-in-id-Box').val();
            let password = $('#sign-in-pw-Box').val();

            if (username == '') {
                alert('IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            } else if(password == '') {
                alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            $.ajax({
                type: "POST",
                url: `/api/user/login`,
                contentType: "application/json",
                data: JSON.stringify({username: username, password: password}),
                success: function (response, status, xhr) {
                    if(response === 'success') {
                        let host = window.location.host;
                        let url = host + '/api/board';

                        document.cookie =
                            'Authorization' + '=' + xhr.getResponseHeader('Authorization') + ';path=/';
                        window.location.href = 'http://' + url;
                    } else {
                        alert('ë¡œê·¸ì¸ì— ì‹¤íŒ¨í•˜ì…¨ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.')
                        window.location.reload();
                    }
                }
            })
        }

        function onclickAdmin() {
            // Get the checkbox
            var checkBox = document.getElementById("admin-check");
            // Get the output text
            var box = document.getElementById("admin-token");

            // If the checkbox is checked, display the output text
            if (checkBox.checked == true){
                box.style.display = "block";
            } else {
                box.style.display = "none";
            }
        }

        function register(){
            $('#signForm').submit();
        }


        function logout(check) {
            // í† í° ê°’ ''ìœ¼ë¡œ ë®ì–´ì“°ê¸°
            document.cookie =
                'Authorization' + '=' + '' + ';path=/';
            if(check) {
                window.location.reload();
            }
        }

        function  getToken() {
            let cName = 'Authorization' + '=';
            let cookieData = document.cookie;
            let cookie = cookieData.indexOf('Authorization');
            let auth = '';
            if(cookie !== -1){
                cookie += cName.length;
                let end = cookieData.indexOf(';', cookie);
                if(end === -1)end = cookieData.length;
                auth = cookieData.substring(cookie, end);
            }

            // kakao ë¡œê·¸ì¸ ì‚¬ìš©í•œ ê²½ìš° Bearer ì¶”ê°€
            if(auth.indexOf('Bearer') === -1 && auth !== ''){
                auth = 'Bearer ' + auth;
            }

            return auth;
        }
    </script>
</head>

<body>
<!-- íšŒì›ê°€ì… ëª¨ë‹¬ì°½ -->
<div class="sign-up-black-bg">
    <div class="sign-up-bg">
        <h1 style="font-family:'PyeongChangPeace-Bold'; text-align: center;">í™˜ì˜í•©ë‹ˆë‹¤!</h1>
        <div class="sign-up-box">
            <form id="signForm" method="POST" action="/api/user/signup">
            <div class="sign-up-inside">
                <p>ë‹‰ë„¤ì„</p>
                    <input type="text" placeholder="6ê¸€ì ë¯¸ë§Œ" id="username" name="username"/>
            </div>
            <div class="sign-up-inside">
                <p>ë¹„ë°€ë²ˆí˜¸</p>
                    <input type="password" placeholder="6ê¸€ì ì´ìƒ" id="password" name="password"/>
            </div>
            <div class="sign-up-inside">
                <p>ì´ë©”ì¼</p>
                    <input type="text" placeholder="6ê¸€ì ë¯¸ë§Œ" id="email" name="email"/>
            </div>
            <div class="sign-up-inside">
                <p>ëŒ€í‘œ ì´ë¯¸ì§€ url</p>
                    <input type="text" placeholder="6ê¸€ì ë¯¸ë§Œ" id="image_url" name="image_url"/>
            </div>
            <div>
                <input id="admin-check" type="checkbox" name="admin" onclick="onclickAdmin()" style="margin-top: 40px;">ê´€ë¦¬ì
                <input id="admin-token" type="password" name="adminToken" placeholder="ê´€ë¦¬ì ì•”í˜¸" class="login-input-box" style="display:none">
            </div>
            </form>
        </div>
        <div style="text-align: center">
            <button type="submit" class="sign-up-btn send-btn" id="sign-up-send" onclick="register()">
                ì™„ë£Œ
            </button>
            <button type="button" class="sign-x-btn close-btn" id="close">
                ë‹«ê¸°
            </button>
        </div>
    </div>
</div>
<!-- ë¡œê·¸ì¸ ëª¨ë‹¬ì°½ -->
<div class="sign-in-black-bg">
    <div class="sign-in-bg">
        <h1 style="font-family:'PyeongChangPeace-Bold'; text-align: center;">ë¡œê·¸ì¸</h1>
        <div class="sign-in-box">
            <button id="login-kakao-btn" onclick="location.href='https://kauth.kakao.com/oauth/authorize?client_id=339181dafb8c6b59189e42ac818b482c&redirect_uri=http://localhost:8080/api/user/kakao/callback&response_type=code'">
                ì¹´ì¹´ì˜¤ë¡œ ë¡œê·¸ì¸í•˜ê¸°
            </button>
            <div class="sign-in-inside">
                <p>ì•„ì´ë””</p>
                <form>
                    <input type="text" placeholder="ID" id="sign-in-id-Box" />
                </form>
            </div>
            <div class="sign-in-inside">
                <p>ë¹„ë°€ë²ˆí˜¸</p>
                <form>
                    <input type="password" placeholder="PW" id="sign-in-pw-Box" />
                </form>
            </div>
        </div>
        <div style="text-align: center">
            <button type="submit" class="sign-in-btn send-btn" id="sign-in-send" onclick="login()">
                ë¡œê·¸ì¸
            </button>
            <button type="button" class="sign-in-x-btn close-btn" id="in-close">
                ë‹«ê¸°
            </button>
        </div>
    </div>
</div>

<!-- ì·¨í–¥ ê³µìœ í•˜ê¸° ëª¨ë‹¬ì°½ -->
<div class="black-bg">
    <div class="white-bg">
        <h1 style="text-align: center; font-family: PyeongChangPeace-Bold">
            'ì·¨í–¥'ì„ ê³µìœ í•˜ì„¸ìš”!
        </h1>

        <div class="write-box">
            <div class="write-box-inside">
                <p>ì¹´í…Œê³ ë¦¬</p>
                <form>
                    <select id="cateBox" size="1">
                        <option value="movie">ì˜í™”</option>
                        <option value="music">ìŒì•…</option>
                        <option value="ani">ì• ë‹ˆ</option>
                        <option value="health">ìš´ë™</option>
                        <option value="book">ì±…</option>
                    </select>
                </form>
            </div>
            <div class="write-box-inside">
                <p>íƒ€ì´í‹€</p>
                <form>
                    <input type="text" class="text-box" placeholder="íƒ€ì´í‹€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" id="titleBox" />
                </form>
            </div>
            <div class="write-box-inside">
                <p>URL</p>
                <form>
                    <input type="text" class="text-box" id="urlBox" placeholder="URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”" />
                </form>
            </div>
            <div class="write-box-inside">
                <p>ì‘ì„±ì</p>
                <form>
                    <input type="text" id="writerBox" class="text-box" placeholder="ì‘ì„±ì ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" />
                </form>
            </div>
            <div class="write-box-inside">
                <p>ì½”ë©˜íŠ¸</p>
                <form>
                    <input type="text" id="commentBox" class="text-box" style="height: 200px" placeholder="ì·¨í–¥ì— ëŒ€í•œ ì½”ë©˜íŠ¸ë¥¼ ë‚¨ê²¨ì£¼ì„¸ìš”" />
                </form>
            </div>
            <div style="clear: both"></div>
        </div>
        <div style="text-align: center">
            <button type="submit" class="write-btn send-btn" id="send" onclick="posting()">
                ì „ì†¡
            </button>
            <button type="button" class="write-btn close-btn" id="close">
                ë‹«ê¸°
            </button>
        </div>
    </div>
</div>
<!-- header ë¶€ë¶„ -->
<div class="contentContainer">
    <div class="headerWrap">
        <div class="memberHeader">
            <a onclick="window.location.href='/'">
                <img src="/image/logo_image.png" class="logo" alt="">
            </a>
            <p id="changeLogo">{{category}}</p>

            <div id="login-true" style="display: none">
                <div id="header-title-login-user">
                    <div id="user"></div> ë‹˜ì˜
                </div>
                <div id="header-title-select-shop">
                    ê²Œì‹œíŒ
                </div>
                <button id="logout" onclick="logout('check')">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
            <div id="login-false" >
                <div id="header-title-select-shop">
                    ê²Œì‹œíŒ
                </div>
                <button id="sign-up">íšŒì›ê°€ì…</button>
                <button id="sign-in">ë¡œê·¸ì¸</button>
            </div>
        </div>
    </div>
    <div class="background">
        <!-- ì™¼ìª½ ë‚´ë¸Œë°” ë¶€ë¶„ -->
        <div class="left-navbar">
            <div class="left-navbar-menu">
                <p>category</p>
            </div>
            <div class="left-navbar-content">
                <div class="category" id="category-1"><a id="movie" onclick="moving(this)">
                    <img src="/image/circle.png" class="circle1" alt="">
                    <div>ì˜í™” ğŸ¬</div>
                </a>
                </div>
                <div class="category" id="category-2"><a id="music" onclick="moving(this)">
                    <img src="/image/circle.png" class="circle2" alt="">
                    <div>ìŒì•… ğŸ§</div>
                </a>
                </div>
                <div class="category" id="category-3"><a id="ani" onclick="moving(this)">
                    <img src="/image/circle.png" class="circle3" alt="">
                    <div>ì• ë‹ˆ ğŸ“º</div>
                </a>
                </div>
                <div class="category" id="category-4"><a id="health" onclick="moving(this)">
                    <img src="/image/circle.png" class="circle4" alt="">
                    <div>ìš´ë™ âš½</div>
                </a>
                </div>
                <div class="category" id="category-5"><a id="book" onclick="moving(this)">
                    <img src="/image/circle.png" class="circle5" alt="">
                    <div>ì±… ğŸ“š</div>
                </a>
                </div>
            </div>
            <button class="write">ë‚´ ì·¨í–¥ ê³µìœ í•˜ê¸°</button>
        </div>

        <div class="body-home">
            <img src="/image/logo_image.png" class="body-home-img" alt="">
        </div>

        <div class="body">
            <div class="mycards">
                <div class="row row-cols-1 row-cols-md-4 g-4" id="cards-box">
                    <div class="col">
                        <div class="card h-100">
                            <img src="https://movie-phinf.pstatic.net/20210728_221/1627440327667GyoYj_JPEG/movie_image.jpg"
                                 class="card-img-top cursor" onclick="newPage()" />
                            <div class="card-body">
                                <h5 class="card-title">ë…¸ë˜ ì œëª©ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤</h5>
                                <p>ì‘ì„±ì</p>
                                <p class="mycomment">ë‚˜ì˜ í•œì¤„ í‰ì„ ì”ë‹ˆë‹¤</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>

    // =============íšŒì›ê°€ì…==============
    $('#sign-up').on('click', function () {
        $('.sign-up-black-bg').addClass('show-modal');
    });
    $('.sign-x-btn').on('click', function () {
        $('.sign-up-black-bg').removeClass('show-modal');
        window.location.reload();
    });

    $('#sign-up-send').on('click', function (e) {
        if ($('#sign-ni-Box').val() === '') {
            alert('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”')
            e.preventDefault()
        }
        if ($('#sign-id-Box').val() === '') {
            alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
            e.preventDefault()
        }
        if ($('#sign-pw-Box').val() === '') {
            alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
            e.preventDefault()
        }
    })

    // ==================ë¡œê·¸ì¸=========================
    $('#sign-in').on('click', function () {
        $('.sign-in-black-bg').addClass('show-modal');
    });
    $('.sign-in-x-btn').on('click', function () {
        $('.sign-in-black-bg').removeClass('show-modal');
        window.location.reload();
    });

    $('#sign-in-send').on('click', function (e) {
        if ($('#sign-in-id-Box').val() === '') {
            alert('ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
            e.preventDefault()
        }
        if ($('#sign-in-pw-Box').val() === '') {
            alert('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
            e.preventDefault()
        }
    })
    // ì·¨í–¥ê³µìœ =========================
    $('.write').on('click', function () {
        $('.black-bg').addClass('show-modal');
    });
    $('.close-btn').on('click', function () {
        $('.black-bg').removeClass('show-modal');
        window.location.reload();
    });
    // ì¹´í…Œê³ ë¦¬ ë‚´ë¹„ë°”===================
    $('#category-1').hover(function () {
        $('.circle1').addClass('circle-show');
    }, function () {
        $('.circle1').removeClass('circle-show')
    });

    $('#category-2').hover(function () {
        $('.circle2').addClass('circle-show');
    }, function () {
        $('.circle2').removeClass('circle-show')
    });

    $('#category-3').hover(function () {
        $('.circle3').addClass('circle-show');
    }, function () {
        $('.circle3').removeClass('circle-show')
    });

    $('#category-4').hover(function () {
        $('.circle4').addClass('circle-show');
    }, function () {
        $('.circle4').removeClass('circle-show')
    });

    $('#category-5').hover(function () {
        $('.circle5').addClass('circle-show');
    }, function () {
        $('.circle5').removeClass('circle-show')
    });

</script>
</body>

</html>